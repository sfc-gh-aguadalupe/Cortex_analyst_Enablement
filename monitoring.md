# Cortex Analyst Performance Monitoring

## Overview

Cortex Analyst provides comprehensive monitoring capabilities to help administrators track performance, identify issues, and continuously improve semantic models. This guide covers the monitoring features available in Snowflake Cortex Analyst based on the [official Snowflake documentation](https://docs.snowflake.com/en/user-guide/snowflake-cortex/cortex-analyst/admin-observability).

## What Gets Logged

Cortex Analyst automatically logs the following information for each request:

- **User Information**: The user who asked the question
- **Question Details**: The natural language question asked
- **Generated SQL**: The SQL query generated by Cortex Analyst
- **Errors and Warnings**: Any issues encountered during processing
- **Request and Response Bodies**: Complete request/response data
- **Metadata**: Additional contextual information

**Note**: There is a small lag of 1-2 minutes between a request being made and it being visible in the monitoring views.

## Accessing Monitoring Data

### Through Snowsight UI

1. Navigate to your Semantic Model in Snowsight
2. Go to the **Monitoring** tab
3. View logs and performance metrics directly in the interface

### Required Privileges

To access monitoring data, users must have:

- **SELECT privilege** on referenced tables
- **OWNERSHIP** on the semantic view (when using semantic views)
- **WRITE privilege** on the stage (for semantic models stored in a file on a stage)

## Querying Logs with SQL

### For Specific Semantic Models/Views

Use the `SNOWFLAKE.LOCAL.CORTEX_ANALYST_REQUESTS` table function to retrieve logs for a specific semantic model or view:

```sql
SELECT * FROM TABLE(
  SNOWFLAKE.LOCAL.CORTEX_ANALYST_REQUESTS(
    '<semantic_model_or_view_type>',
    '<semantic_model_or_view_name>'
  )
);
```

#### Parameters

- **`_semanticmodelorviewtype_`**: Specify the type of semantic model or view:
  - `'FILE_ON_STAGE'` - For semantic models defined in a file on a stage
  - `'SEMANTIC_VIEW'` - For semantic views

- **`_semanticmodelorviewname_`**: Specify the location:
  - For file-based models: Fully qualified path (e.g., `@my_db.my_schema.my_stage/path/to/file.yaml`)
  - For semantic views: Fully qualified name of the semantic view

### For All Requests (Admin Role Required)

If you have the `SNOWFLAKE.CORTEX_ANALYST_REQUESTS_ADMIN` application role, you can query all requests across all semantic models:

```sql
SELECT * FROM SNOWFLAKE.LOCAL.CORTEX_ANALYST_REQUESTS_V;
```

### Raw Event Data

For advanced analysis, you can query the raw event data in the `SNOWFLAKE.LOCAL.CORTEX_ANALYST_REQUESTS_RAW` event table. This data is in OpenTelemetry format and contains the same information as the view but in a more detailed format.

## Key Monitoring Use Cases

### 1. Performance Analysis
- Track query response times
- Identify slow-performing queries
- Monitor resource utilization

### 2. Quality Assurance
- Review generated SQL for accuracy
- Identify common error patterns
- Track query success rates

### 3. User Adoption
- Monitor active users
- Track query frequency
- Identify popular question patterns

### 4. Model Improvement
- Analyze failed queries to improve model definitions
- Identify missing relationships or synonyms
- Track verified query usage

## Best Practices for Monitoring

### Regular Review Schedule
- Set up regular monitoring reviews (daily/weekly)
- Focus on error rates and performance trends
- Track user adoption metrics

### Alerting Setup
- Configure alerts for high error rates
- Monitor for unusual query patterns
- Set up notifications for performance degradation

### Data Retention
- Understand your organization's data retention policies
- Archive historical monitoring data as needed
- Consider data privacy requirements

## Troubleshooting Common Issues

### Access Denied Errors
- Verify user has required privileges
- Check semantic model/view ownership
- Ensure proper role assignments

### Missing Data
- Remember the 1-2 minute lag for new requests
- Verify the semantic model/view name is correct
- Check if queries were made using inline YAML (not accessible via table function)

### Performance Issues
- Review generated SQL for optimization opportunities
- Check for missing relationships in semantic models
- Analyze query patterns for common issues

## Integration with Other Tools

### Snowflake Dashboards
- Create custom dashboards using monitoring data
- Set up automated reports
- Integrate with existing BI tools

### External Monitoring
- Export data to external monitoring systems
- Set up custom alerting rules
- Integrate with enterprise monitoring platforms

## Next Steps

1. **Set up monitoring** for your semantic models
2. **Review logs regularly** to identify improvement opportunities
3. **Create dashboards** to track key metrics
4. **Establish alerting** for critical issues
5. **Use insights** to continuously improve your semantic models

---

*For the most up-to-date information, refer to the [official Snowflake Cortex Analyst monitoring documentation](https://docs.snowflake.com/en/user-guide/snowflake-cortex/cortex-analyst/admin-observability).*
